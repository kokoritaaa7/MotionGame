{% extends './base.html' %}   
{% load static %} 
{% block content %}
{% include "./motiongesture.html" %}


<style>
    .modal-body h6, 
    .modal-header h5 {
        color:black;
    }
</style>


    <!-- banner-section start -->
    <section id="banner-section" class="inner-banner features shop">
        <div class="ani-img">
            <img class="img-1" src="{% static 'MG/images/banner-circle-1.png' %}" alt="icon">
            <img class="img-2" src="{% static 'MG/images/banner-circle-2.png' %}" alt="icon">
            <img class="img-3" src="{% static 'MG/images/banner-circle-2.png' %}" alt="icon">
        </div>
        <div class="banner-content d-flex align-items-center">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-lg-6">
                        <div class="main-content">
                            <h1> Î¶¨Îì¨ Í≤åÏûÑ </h1>
                            <div class="breadcrumb-area">
                                <nav aria-label="breadcrumb">
                                    <ol class="breadcrumb d-flex justify-content-center">
                                        <a href="Îû≠ÌÇπ">Îû≠ÌÇπ Î≥¥Îü¨Í∞ÄÍ∏∞</a></li>
                                        <li class="breadcrumb-item"><a href="/MG/ranking_board/">Îû≠ÌÇπ Î≥¥Îü¨Í∞ÄÍ∏∞</a></li>
                                    </ol>
                                </nav>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </section>
    <!-- banner-section end -->


    </section>
    <!-- banner-section end -->

    <!-- unity Í≤åÏûÑ ÌôîÎ©¥ (Ï†àÎåÄÏ¢åÌëú)-->
    <div id="unity-container" class="unity-desktop">
        <div class="overlay">

                <div class="row">
                    <div class="col-lg-8">
                        <canvas id="unity-canvas" style="margin-left: 10%; margin-top: 10%;"></canvas>
                    </div>
                    <div class="col-lg-4">
                        <button class="cmn-btn" type="submit" onclick="onDisplay()" style="margin-left: 30%; margin-top: 10%; position: relative;">Webcam</button>
                        <div id="webcam"  style="margin-left: 13%;">
                        <!-- Ïπ¥Î©îÎùº ÌôîÎ©¥ -->
                            <div class="container1">
                                <video class="input_video" style="display:none;" ></video>
                            </div>

                            <canvas class="output_canvas"></canvas>
                            <div class = "frame"></div>
                        </div>
                    </div>
                    <div id="unity-loading-bar">
                    <div id="unity-progress-bar-empty">
                        <div id="unity-progress-bar-full"></div>
                    </div>
                    </div>
                </div>

        </div>
        <div id="unity-loading-bar">
            <div id="unity-logo"></div>
            <div id="unity-progress-bar-empty"></div>
            <div id="unity-progress-bar-full"></div>
        </div>
        <div id="unity-mobile-warning">
        </div>
        <div id="unity-footer">
            <div id="unity-webgl-logo"></div>
            <div id="unity-fullscreen-button"></div>
            <div id="unity-build-title"></div>
        </div>
    </div>


    <!-- unity Í≤åÏûÑ ÌôîÎ©¥ (Ï†àÎåÄÏ¢åÌëú)-->
    <div id="unity-container" class="unity-desktop">
        <canvas id="unity-canvas" width=960 height=600 style="margin-left: 10%;"></canvas>
        <div id="unity-loading-bar">
        <div id="unity-logo"></div>
        <div id="unity-progress-bar-empty">
            <div id="unity-progress-bar-full"></div>
        </div>
        </div>
        <div id="unity-mobile-warning">
        WebGL builds are not supported on mobile devices.
        </div>
        <div id="unity-footer">
        <div id="unity-webgl-logo"></div>
        <div id="unity-fullscreen-button"></div>
        <div id="unity-build-title">New Unity Project</div>
        <div id="unity-command" name='None' style="display: none;"></div>
        </div>
    </div>


    <!-- Testimonials Content Start -->
    {% comment %} <section id="tournaments-content"> {% endcomment %}
        <div class="tab-content" id="myTabContent">
            <div class="tab-pane fade show active" id="overview" role="tabpanel"
                aria-labelledby="overview-tab">
                <div class="container pb-120">
                    <div class="row justify-content-center">
                        <div class="col-lg-8">
                            {% comment %} <h4 class="head-area">Motion Game</h4>
                            <div class="row wrapper">

                            </div>
                            <div class="info-area">
                                <h4>Information</h4>
                                <div class="single-info">
                                    <h5>Format</h5>
                                    <ul>
                                        <li>Map pool: Selected Aim Maps</li>
                                        <li>All kind of cheating will result in a permanent suspension from Begam.</li>
                                        <li>Playing with a cheater will result in a 3 month suspension from Begam.</li>
                                        <li>Toxic behaviour will cause warnings and in severe cases both disqualifications and
                                            suspensions.</li>
                                    </ul>
                                </div>
                                <div class="single-info">
                                    <h5>Prize Claim</h5>
                                    <p>Prize claims must be completed within 24 hours of the end of the tournament
                                        otherwise risk penalty of the prize. Claims can take up to 72 hours to be processed.</p>
                                </div>
                                <div class="single-info">
                                    <h5>Rules</h5>
                                    <ul>
                                        <li>Please be respectful to your host and other participants. If any malicious behavior
                                            is reported, you will be removed from the tournament.</li>
                                        <li>Please be on time for your registration and for the actual tournament. You
                                            (and your team) will be disqualified on no-show.</li>
                                        <li>You and all of your teammates must be registered to qualify for the event.</li>
                                        <li>You can play in this tournament only if your registered and in-game names match,
                                            otherwise you will be disqualified.</li>
                                    </ul>
                                </div>
                            </div> {% endcomment %}
                            {% comment %} <div class="magnific-area">
                                <img src="{% static 'MG/images/magnific-bg.png' %}" alt="image">
                                <a href="https://www.youtube.com/watch?v=MJ0zpsWQ_XM" class="mfp-iframe popupvideo">
                                    <img src="{% static 'MG/images/play-icon-2.png' %}" alt="image">
                                </a>
                            </div> {% endcomment %}
                        </div>
                        <div class="col-lg-4 col-md-6">
                            <div class="sidebar">
                                <div class="single-side">
                                    <button class="cmn-btn" type="submit">Webcame</button>
                                        <!-- Ïπ¥Î©îÎùº ÌôîÎ©¥ -->
                                        <div class="container1">    
                                            <video class="input_video" style="display: None;"></video>
                                            <canvas class="output_canvas" width="1280px" height="720px"></canvas>
                                        </div>

                                        <canvas class="output_canvas"></canvas>
                                        <div class = "frame"></div>
                                </div>
                                
                                
                            </div>

                    <div class="col-lg-4">
                        <div class="right-sidebar"> 
                            <div class="top-area">

                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>

    {% comment %} </section> {% endcomment %}
    <!-- Testimonials Content End -->

    <!-- Button trigger modal -->
    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModalCenter">
    Launch demo modal
    </button>

    <!-- Modal -->
    <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered bd-example-modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLongTitle">Save your score at Ranking BoardüèÜ</h5>
                </div>
                <div class="modal-body">
                    <h6>Your Score is XXXX</h6>
                    <h6>Ranking BoardÏóê Ï†ÄÏû•Ìï† Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî</h6><br>
                    <input type="text" placeholder="Enter Your NickName" id="nickname">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="sendScore()">Save</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>                    
                    <!-- Save Î≤ÑÌäº ÎàÑÎ•¥Î©¥ AJAXÎ°ú Í∞ÄÏÑú ÏÑúÎ≤ÑÎ°ú Ï†ÑÎã¨ -->
                </div>
            </div>
        </div>
    </div>

    <script>
    // ÏÑ±Ï§ÄÎãò ÏΩîÎìú ==> unityÏóêÏÑú ResultSave Ìï®Ïàò Ìò∏Ï∂úÌïòÎèÑÎ°ù ÎßåÎì§Ïñ¥ÎÜîÏÑú Ïù¥ Ïù¥Î¶ÑÏúºÎ°ú ÎßåÎì§Ïñ¥ÏïºÎêòÍ≥†
    // Îî∞ÎùºÏÑú, ÎÇ¥Î∂ÄÎßå Î≥ÄÍ≤ΩÌïòÎ©¥ Îê®
    // ÌÅ¥Î¶≠ÎèÑ ÌïÑÏöî ÏóÜÏùå -> Ïú†ÎãàÌã∞ÏóêÏÑú Î≤ÑÌäº ÏûàÎäîÍ±∞ÎãàÍπå  
      function ResultSave(score){
          const default_name = "Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî."

          const name = window.prompt("Score : " + score, default_name)
          if(name === default_name || name === null){
            alert("Ï∑®ÏÜåÌñàÏäµÎãàÎã§.")
          }else{
            alert(name + " Îãò Ï†êÏàò : " + score)
          }
      }
    </script>

    <script>
        function sendScore() {

            let nickname = document.getElementById('nickname')

            $.ajax({
                url:'/MG/sendScore',
                type:'',
                data:{
                    'id': nickname,
                    'score': ''
                },
                success: function(res){
                    location.href="/MG/ranking_board"
                    // modal ÎÅÑÍ≥† Ranking BoardÎ°ú Ïù¥Îèô
                },
                error: function(err){
                    //alert?
                }
            });
        }
        
    function onDisplay() {
      if($('#webcam').css('display') == 'none'){
      $('#webcam').show();}
      else{
      $('#webcam').hide();
    }
    }
    </script>


    <script src="{% static 'MG/js/jquery-3.5.1.min.js' %}"></script>
    <script src="{% static 'MG/js/bootstrap.min.js' %}"></script>
    <script src="{% static 'MG/js/slick.js' %}"></script>
    <script src="{% static 'MG/js/jquery.nice-select.min.js' %}"></script>
    <script src="{% static 'MG/js/fontawesome.js' %}"></script>
    <script src="{% static 'MG/js/countdown.jquery.js' %}"></script>
    <script src="{% static 'MG/js/jquery.counterup.min.js' %}"></script>
    <script src="{% static 'MG/js/jquery.waypoints.min.js' %}"></script>
    <script src="{% static 'MG/js/jquery.magnific-popup.min.js' %}"></script>
    <script src="{% static 'MG/js/wow.js' %}"></script>
    <script src="{% static 'MG/js/main.js' %}"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="http://ajax.cdnjs.com/ajax/libs/json2/20110223/json2.js"></script>

    <script type="module">







    const videoElement = document.getElementsByClassName('input_video')[0];
    const canvasElement = document.getElementsByClassName('output_canvas')[0];
    const canvasCtx = canvasElement.getContext('2d');

    var csrf_token = '{{ csrf_token }}';
    var xhr = new XMLHttpRequest();
    
    let x;
    
    function onResults(results) {
      canvasCtx.save();
      canvasCtx.translate(canvasElement.width, 0);
      canvasCtx.scale(-1,1);
      canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);
      canvasCtx.drawImage(
          results.image, 0, 0, canvasElement.width, canvasElement.height);
      if (results.multiHandLandmarks) {
        for (const landmarks of results.multiHandLandmarks) {
        

          x = JSON.stringify({landmarks})
          

          drawConnectors(canvasCtx, landmarks, HAND_CONNECTIONS,
                         {color: '#00FF00', lineWidth: 5});
          drawLandmarks(canvasCtx, landmarks, {color: '#FF0000', lineWidth: 2});
        }
      }
      canvasCtx.restore();
    }
    let s=0;
    let t
    setInterval(function(){
      $.ajax({
            url: '../landmark_data/',
            type: 'POST',
            data: {'landmarks' : x },
            dataType : 'json',
            beforeSend: function(xhr) {
              xhr.setRequestHeader('X-CSRFToken', csrf_token);
            },
          success:function(res){
              console.log(res)
            if (res['location']=='None'){
              console.log('there is no landmarks');
              t=document.getElementById('unity-command').className=res['locaiton']
            }
            else {
              x=NaN;
              console.log(res['location']);
              t=document.getElementById('unity-command').className=res['locaiton']

            }
          },
          error:function(){
            x=NaN
            t=document.getElementById('unity-command').className=res['None']
            console.log('error')
            //Îç∞Ïù¥ÌÑ∞Î•º ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏Î°ú Î≥¥ÎÇ¥ÏÑú Ìï¥Í≤∞
          }
      })
    }, 1000) // nÎ∞ÄÎ¶¨Ï¥àÏóê Ìïú Î≤àÏî© Ï†ÑÏÜ° // Ìï¥Îãπ ÌéòÏù¥ÏßÄÍ∞Ä ÏïÑÎãàÎçîÎùºÎèÑ 0.1Ï¥àÏóê ÌïúÎ≤àÏî© Îç∞Ïù¥ÌÑ∞ Ï†ÑÏÜ°ÌïòÎäî Í≤É Í∞ôÏùå (ConsoleÏóê ÏûêÍæ∏ ÏóêÎü¨ Ï∞çÌûò)
    
    const hands = new Hands({locateFile: (file) => {
      return `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`;
    }});
    hands.setOptions({
      maxNumHands: 2,
      minDetectionConfidence: 0.5,
      minTrackingConfidence: 0.5
    });
    hands.onResults(onResults);
    
    const camera = new Camera(videoElement, {
      onFrame: async () => {
        await hands.send({image: videoElement});
      },
      width: 1280,
      height: 720
    });
    camera.start();

    

    </script>

{% endblock  %}